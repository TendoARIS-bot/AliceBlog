---
import MainGridLayout from "@layouts/MainGridLayout.astro";
import PostCard from "@components/PostCard.astro";
import { getCollection } from "astro:content";
import { i18n } from "@i18n/translation";
import I18nKey from "@i18n/i18nKey";

const posts = await getCollection("posts");
const categories = new Set<string>();

posts.forEach((post) => {
	if (post.data.category) {
		categories.add(post.data.category);
	}
});

const categoryList = Array.from(categories).map((category) => {
	const count = posts.filter((post) => post.data.category === category).length;
	return { name: category, count };
});
---

<MainGridLayout title={i18n(I18nKey.categories)}>
	<div class="max-w-[var(--page-width)] mx-auto px-4 py-8">
		<div class="grid grid-cols-1 md:grid-cols-2 gap-4">
			{categoryList.map((category) => (
				<a
					href={`/categories/${category.name}/`}
					class="card-base p-6 rounded-xl hover:shadow-lg transition-shadow scale-animation"
				>
					<h2 class="text-xl font-bold text-[var(--primary)] dark:text-purple-300 mb-2">
						{category.name}
					</h2>
					<p class="text-[var(--text-secondary)]">
						{category.count} 篇文章
					</p>
				</a>
			))}
		</div>
	</div>
</MainGridLayout>
